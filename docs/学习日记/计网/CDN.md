# CDN

> <https://baijiahao.baidu.com/s?id=1727538395338635348&wfr=spider&for=pc>

## 概念

Content Delivery NetWork 内容分发网络。实际上 CDN 这个概念是在 1996 年由美国麻省理工学院的一个研究小组为改善互联网的服务质量而提出的。那么它到底是怎么改善互联网服务质量的呢?

### 原理分析

当我们使用域名访问某一个网站时，实际上就是将请求包（以 Http 请求为例）通过网络传输给某台服务器。比如访问 “www.baidu.com".

- 首先解析该域名对应的 ip 地址（DNS 域名解析）
- 然后将 Http 请求包通过网络路由到 IP 地址所对应的服务器
- 我们通常说”服务器的 ip 地址“，这其实不太准确，ip 地址是和网卡绑定的，一个服务器可以有多个网卡，也就是可能有多个 ip 地址。

#### 域名解析

分两种：

1. 将一个域名解析为一个 ip 地址
2. 将一个域名解析为另外一个域名

即：域名 --> ip
域名 --> 别名 CNAME

#### cdn 原理

首先 CDN 是为了改善互联网的服务质量的。通俗一点说其实就是提高访问速度。

假设百度网站现在只有一台服务器，现在有一个人在上海访问百度，如果该服务器也在上海，那么通常来说访问比较快，如果该服务器在拉萨，那么相对而言访问就比较慢了。**那么这个问题的根本原因是网络传输是依赖于网线的，网线越长，那么时间肯定就越久。**

CDN 的基本原理是广泛采用各种缓存服务器，将这些缓存服务器分布到用户访问相对集中的地区或网络中。在用户访问网站时，利用全局负载技术将用户的访问指向**距离最近的工作正常的缓存服务器上，由缓存服务器直接响应用户请求。**

### CDN 特点

1、本地 Cache 加速：

提高了企业站点（尤其含有大量图片和静态页面站点）的访问速度，并大大提高以上性质站点的稳定性。

2、镜像服务：

消除了不同运营商之间互联的瓶颈造成的影响，实现了跨运营商的网络加速，保证不同网络中的用户都能得到良好的访问质量。

3、远程加速：

远程访问用户根据 DNS 负载均衡技术智能自动选择 Cache 服务器，选择最快的 Cache 服务器，加快远程访问的速度。
4、带宽优化：

自动生成服务器的远程 Mirror（镜像）cache 服务器，远程用户访问时从 cache 服务器上读取数据，减少远程访问的带宽、分担网络流量、减轻原站点 WEB 服务器负载等功能。

5、集群抗攻击：

广泛分布的 CDN 节点加上节点之间的智能冗余机制，可以有效地预防黑客入侵以及降低各种 D.D.o.S 攻击对网站的影响，同时保证较好的服务质量 。

> <https://worktile.com/kb/p/30328>

## CDN 技术原理

1. 用户向浏览器提供要访问网站的域名，域名解析的请求被发往本地用户使用的 DNS 服务器，本地 DNS 服务器将解析请求转发至网站的 DNS 服务器（NS）;

2. 由于网站的 DNS 服务器（NS）对此域名的解析设置了 CNAME,请求最终被指向到 CDN 网络中的 GLB 系统。

3. GLB 系统对域名进行智能解析，将响应速度最快的节点 IP 返回给用户

4. 浏览器在得到实际的 ip 地址后，向 CDN 节点发出访问请求；

5. 由于是第一次访问，CDN 节点将回到源站获得用户请求的数据并发给用户，同时 CDN 节点根据缓存策略对该数据进行缓存；

6. 当有其他用户再次访问同样内容时， CDN 节点直接将数据返回给客户， 完成请求/服务过程。

## 影响 cdn 加速效果的因素

1. CDN 主要是靠把网站内容缓存到各个节点服务器，不同地区的访问者可以就近访问，起到加速效果。

2. 当用户访问一些不能缓存的内容时， CDN 节点会临时去你源站获取，此时，如果到你源站的链路不好的话，就会导致这个过程很慢。所以，你源站链路状况也是比较重要的。

3. 还跟 CDN 服务质量有关。度包括它的智能调度、CDN 节点链路状况等。
